переменные окружения

## backend

обязательные:
- PORT — порт api (по умолчанию 4000)
- IMPORT_SHEET_ID — id google sheet (без /edit?..)
- GOOGLE_SA_JSON — json сервисного аккаунта (одной строкой)
- ADMIN_IMPORT_KEY — ключ для ручного импорта
- TG_WEBAPP_URL — url фронтенда (для cors)

опциональные:
- TG_BOT_TOKEN — токен бота (для отправки сообщений о заказах)
- TG_BOT_USERNAME — username бота без @ (для deep link после оплаты, опционально)
- SUPPORT_USERNAME — username менеджера без @ (по умолчанию: `semyonp88`)
- TG_MANAGER_CHAT_ID — chat_id менеджера (для отправки сообщений о заказах и проверки доступа к рассылке)
  - как получить: написать боту `/start`, затем найти свой chat_id через @userinfobot или в логах бота
- ROBOKASSA_MERCHANT_LOGIN — логин магазина в Робокассе (для оплаты)
- ROBOKASSA_PASSWORD_1 — пароль #1 для создания платежей (из ЛК Робокассы)
- ROBOKASSA_PASSWORD_2 — пароль #2 для проверки callback (из ЛК Робокассы)
- ROBOKASSA_TEST — включить тестовый режим (`true`/`1` для теста, иначе production)
- DB_URL — postgres url (на mvp можно без бд)
- SHEET_NAMES — названия листов через запятую (по умолчанию: `ягоды,шея,руки,уши,сертификаты`)
- IMPORT_INTERVAL_MINUTES — интервал автоматического импорта в минутах (по умолчанию: `10`, `0` = отключить)

пример команды импорта (локально):

curl -X POST "http://localhost:4000/admin/import/sheets" \
  -H "x-admin-key: $ADMIN_IMPORT_KEY"

## bot

обязательные:
- TG_BOT_TOKEN — токен бота

опциональные:
- TG_WEBAPP_URL — url фронтенда (по умолчанию: `http://localhost:5173`)
- BACKEND_URL — url бэкенда для keep-alive (по умолчанию: берется из TG_WEBAPP_URL или `http://localhost:4000`)
  - используется ботом для периодических запросов, чтобы бэкенд не засыпал на Render
- SUPPORT_USERNAME — username менеджера без @ (для проверки доступа к команде `/broadcast`)
- TG_MANAGER_CHAT_ID — chat_id менеджера (для проверки доступа к команде `/broadcast`)

**команды бота:**
- `/start` — открыть мини-приложение
- `/support` — ссылка на менеджера
- `/broadcast` — рассылка сообщений всем пользователям (только для менеджера)
- `/cancel` — отмена рассылки

**рассылка:**
1. Менеджер отправляет `/broadcast`
2. Бот активирует режим ожидания
3. Менеджер отправляет текст или фото с подписью
4. Бот рассылает всем пользователям (которые когда-либо использовали бота)

## frontend

опциональные:
- VITE_API_URL — url бэкенда (по умолчанию: `/api`)
- VITE_SUPPORT_USERNAME — username менеджера без @ (для ссылок на менеджера, по умолчанию: `koshekmanager`)
- VITE_BOT_USERNAME — username бота без @ (для ссылок на бота в модалке "заказ через Telegram", по умолчанию: `koshekjewerlybot`)
- VITE_TEST_PRODUCT_SLUG — slug тестового товара (для отключения доставки при тестировании оплаты)
  - если в корзине только тестовый товар - доставка будет бесплатной
  - если есть обычные товары - доставка считается как обычно
  - пример: `test-product-1-rub`

## настройка робокассы

**1. в личном кабинете Робокассы:**
- Создай магазин (если еще не создан)
- Найди в настройках магазина:
  - **Merchant Login** — это идентификатор/логин магазина (уникальное имя магазина, например: `koshekjewerly`)
  - **Password #1** — пароль для создания платежей (в разделе "Технические настройки" или "Пароли")
  - **Password #2** — пароль для проверки callback (там же)

**2. настройка URL для callback:**
В настройках магазина укажи:
- **Result URL**: `https://твой_backend.onrender.com/api/robokassa/result`
  - **Метод отправки**: POST (обязательно)
- **Success URL**: `https://твой_backend.onrender.com/api/robokassa/success`
  - **Метод отправки**: GET (рекомендуется, но поддерживается и POST)
- **Fail URL**: `https://твой_backend.onrender.com/api/robokassa/fail`
  - **Метод отправки**: GET (рекомендуется, но поддерживается и POST)
- **Алгоритм хэша**: MD5

**3. переменные окружения (backend на Render):**
```
ROBOKASSA_MERCHANT_LOGIN=твой_merchant_login  # идентификатор магазина (не email!)
ROBOKASSA_PASSWORD_1=пароль_1
ROBOKASSA_PASSWORD_2=пароль_2
ROBOKASSA_TEST=true  # для тестирования, потом убрать или false
TG_BOT_USERNAME=твой_бот_username  # без @, например: my_shop_bot
```

**Важно:** Если `TG_BOT_USERNAME` не указан, после оплаты пользователь будет редиректиться на фронтенд. При указании username бота — пользователь вернется в бота с сообщением о результате оплаты и кнопкой для открытия мини-приложения.

**4. тестирование:**
- В тестовом режиме можно использовать тестовые карты из документации Робокассы
- После тестов убери `ROBOKASSA_TEST` или установи в `false` для production

**процесс оплаты:**
1. Пользователь оформляет заказ
2. Создается заказ со статусом `pending`
3. Генерируется URL для оплаты в Робокассе
4. Пользователь переходит на страницу оплаты
5. После оплаты Робокасса отправляет callback на `/api/robokassa/result`
6. Обновляется статус заказа на `paid`
7. Отправляются уведомления в Telegram покупателю и менеджеру
8. Пользователь редиректится:
   - Если указан `TG_BOT_USERNAME` → возвращается в бота с сообщением об успехе и кнопкой для открытия мини-приложения
   - Если не указан → возвращается на фронтенд (`/payment/success`)


